<?php

/*
 * Implements hook_menu()
 */
function cse_selector_menu() {
  $items['admin/config/content/cse_selector'] = array(
    'title' => 'Google Custom Search',
    'description' => 'Google Custom Search',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('cse_selector_settings'),
    'file' => 'cse_selector.admin.inc',
    'access arguments' => array('administer'),
  );
  return $items;
}
/*
 * Implements hook_help for Custom Search
 */
function cse_selector_help($path, $arg) {
  switch ($path) {
    case 'admin/help#cse_selector':
      $output = '';
      $output .= '<h3>' . t('About') . '</h3>';
      $output .= '<p>' . t('This module implements Google\'s Custom Search engine to search either under a particular page or the entire site') . '</p>';
      $output .= '<dt>' . t('Information') . '<dt>';
      $output .= '<dd>' . t('This module consists of a search bar in the header, and a search page with a second search bar and a radio selection to define the \'as_sitesearch\' parameter to the specific subpage, and the search results. The default behavior will be to search on the subpage') . '</dd>';
      $output .= '<dt>' . t('Configuration') . '</dt>';
      $output .= '<dd>' . t('The Google Search API Key can be configured at admin/config/content/cse_selector_help') . '</dd>';
      break;
  }
}

/*
 * Implements Google CSE Selector Search Box
 * Can be easily modified to remove radios under searchbar by passing parameter
 */
function cse_selector_search_form($form, &$state) {
  $form['#method'] = 'get';
  $form['search'] = array(
    '#type' => 'fieldset',
    '#title' => t('')
  );
  $form['search']['q'] = array(
    '#type' => 'textfield',
    '#default_value' => '',
  );
  $form['search']['search_submit']  = array(
    '#type' => 'submit',
    '#value' => t('Search'),
  );
  if (TRUE) {
    $form['search']['radio'] = array(
      '#type' => 'radios',
      '#options' => array(
        'narrow' => str_replace('<Site Name>',variable_get('site_name'), t(variable_get('cse_narrow_search_text'))),
        'wide' => t(variable_get('cse_wide_search_text')),
      ),
      '#default_value' => variable_get('cse_default_search_type'),
    );
  }
  return $form;
}
function cse_selector_search_form_submit() {
  echo '1';
}
//Implements hook_block_info for selector search and results
function cse_selector_block_info() {
  $blocks['search'] = array(
    'info' => t('Google Custom Search Bar'),
    'cache' => DRUPAL_NO_CACHE,
  );
  $blocks['results'] = array(
    'info' => t('Google Custom Search Results'),
    'cache' => DRUPAL_NO_CACHE,
  );

  return $blocks;
}
// Implements hook_block_view for selector search and results
function cse_selector_block_view($delta) {
  switch ($delta) {
    case 'search':
    //Calls for search form
      $block['content'] = drupal_get_form('cse_selector_search_form');
      return $block;
      break;
    case 'results':
    //Outputs search results
      $block = '<gcse:searchresults-only as_sitesearch="' . variable_get('cse_narrow_search_query', 'https://www.extension.iastate.edu' . base_path());
      $block .= '" queryParameterName="' . variable_get('cse_url_text');
      $block .= '"></gcse:searchresults-only>';
      return $block;
      break;
  }
}
